datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// Models
model Foundation {
  id      String  @id @default(cuid())
  name    String
  pan     String  @unique
  logoUrl String?

  createdAt DateTime @default(now())
  createdBy String   @default("system")
  updatedAt DateTime @updatedAt
  updatedBy String   @default("system")

  users     User[]
  donors    Donor[]
  donations Donation[]
}

model User {
  id           String @id @default(cuid())
  username     String @unique
  passwordHash String
  role         String

  createdAt DateTime @default(now())
  createdBy String   @default("system")
  updatedAt DateTime @updatedAt
  updatedBy String   @default("system")

  foundation   Foundation @relation(fields: [foundationId], references: [id])
  foundationId String
}

model Donor {
  id        String  @id @default(cuid())
  fullName  String
  address1  String
  address2  String
  pan       String  @unique
  phone     String  @default("")
  country   String
  state     String
  city      String
  isDeleted Boolean @default(false)

  createdAt DateTime @default(now())
  createdBy String   @default("system")
  updatedAt DateTime @updatedAt
  updatedBy String   @default("system")

  foundation   Foundation @relation(fields: [foundationId], references: [id])
  foundationId String
  donations    Donation[]
}

enum DonationType {
  CASH
  CHEQUE
  ONLINE
}

enum DonationStatus {
  PENDING
  RECEIVED
}

model Donation {
  id               String         @id @default(cuid())
  donor            Donor          @relation(fields: [donorId], references: [id])
  donorId          String
  amount           Float
  type             DonationType
  bankName         String
  utr              String
  ifsc             String
  donationDate     DateTime       @default(now())
  transactionDate  DateTime?
  donationReceived DonationStatus @default(PENDING)
  isPrinted        Boolean        @default(false)
  isDeleted        Boolean        @default(false)

  createdAt DateTime @default(now())
  createdBy String   @default("system")
  updatedAt DateTime @updatedAt
  updatedBy String   @default("system")

  foundation   Foundation @relation(fields: [foundationId], references: [id])
  foundationId String

  @@index([foundationId, donorId])
  @@index([donorId, isDeleted])
}
